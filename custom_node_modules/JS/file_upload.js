'use strict';

const fs = require('fs');
const path = require('path');
const mimeTypes = require('../JSON/mime_types.json');

async function fileUpload(url, res) {
  const ext = String(path.extname(url)).toLocaleLowerCase();
  console.log(url);
  // if ( !url.toLocaleLowerCase().includes('public') ) {
  //   console.log(`такого url: ${url} нет в директории public`);
  //   res.end();
  //   return;
  // }

  if (ext in mimeTypes) {
    res.setHeader('Content-Type', mimeTypes[ext]);

    fs.readFile(`.${url}`, (error, data) => {
      if (error) {
        console.log(`ошибка при чтении файла ${url}`);
        res.end();
        return;
      }

      res.end(data);
      return;
    });

    return;
  } else {
    console.log(`ошибка: расширения ${ext} нет в mimeTypes`);
    res.end();
    return;
  }
}

module.exports = fileUpload;
